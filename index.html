<script>
  paypal.Buttons({
    createOrder: function () {
      return fetch('https://paypal-backend-u81a.onrender.com/api/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => {
        if (!res.ok) {
          throw new Error('Error creating the order');
        }
        return res.json();
      })
      .then(data => data.id);
    },
    onApprove: function (data) {
      return fetch(`https://paypal-backend-u81a.onrender.com/api/orders/${data.orderID}/capture`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => {
        if (!res.ok) {
          throw new Error('Error capturing the order');
        }
        return res.json();
      })
      .then(details => {
        alert('Thank you for your purchase, ' + details.payer.name.given_name + '!');
      })
      .catch(err => {
        console.error('Capture error:', err);
        alert('There was an error capturing your payment.');
      });
    },
    onError: function (err) {
      console.error('PayPal error:', err);
      alert('There was an error processing your payment.');
    }
  }).render('#paypal-button-container');
</script>
